id: 42a8f1e3-9b7c-4d2f-8a1e-5c3d7f9e2b4a
name: MS Catalogs gRPC Helm Chart
schemaVersion: designs.meshery.io/v1beta1
version: 0.0.1
metadata:
  description: "Microservice Catalogs gRPC - A catalog management microservice with gRPC API for product/service catalog operations"
  source: "helm"
  chart:
    name: "ms-catalogs-grpc"
    version: "1.0.0"
    repository: "custom-microservice"
  labels:
    helm: "true"
    microservice: "true"
    grpc: "true"
    catalog: "true"
    api: "true"
components:
  - id: ms-catalogs-grpc-deployment
    name: MS Catalogs gRPC Deployment
    type: Deployment
    namespace: catalogs
    version: apps/v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc
        labels:
          app: ms-catalogs-grpc
          version: v1
      spec:
        replicas: 3
        selector:
          matchLabels:
            app: ms-catalogs-grpc
            version: v1
        template:
          metadata:
            labels:
              app: ms-catalogs-grpc
              version: v1
          spec:
            containers:
            - name: ms-catalogs-grpc
              image: ms-catalogs-grpc:latest
              ports:
              - containerPort: 8080
                name: grpc
                protocol: TCP
              - containerPort: 8081
                name: health
                protocol: TCP
              env:
              - name: GRPC_PORT
                value: "8080"
              - name: HEALTH_PORT
                value: "8081"
              - name: DATABASE_URL
                valueFrom:
                  secretKeyRef:
                    name: ms-catalogs-grpc-secret
                    key: database-url
              resources:
                limits:
                  cpu: 500m
                  memory: 512Mi
                requests:
                  cpu: 200m
                  memory: 256Mi
              livenessProbe:
                httpGet:
                  path: /health
                  port: 8081
                initialDelaySeconds: 30
                periodSeconds: 10
              readinessProbe:
                httpGet:
                  path: /ready
                  port: 8081
                initialDelaySeconds: 5
                periodSeconds: 5
    traits:
      position:
        x: 300
        y: 200

  - id: ms-catalogs-grpc-service
    name: MS Catalogs gRPC Service
    type: Service
    namespace: catalogs
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc
        labels:
          app: ms-catalogs-grpc
      spec:
        selector:
          app: ms-catalogs-grpc
        ports:
        - name: grpc
          port: 8080
          targetPort: 8080
          protocol: TCP
        - name: health
          port: 8081
          targetPort: 8081
          protocol: TCP
        type: ClusterIP
    traits:
      position:
        x: 500
        y: 200

  - id: ms-catalogs-grpc-configmap
    name: MS Catalogs gRPC ConfigMap
    type: ConfigMap
    namespace: catalogs
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc-config
      data:
        app.properties: |
          grpc.server.port=8080
          health.server.port=8081
          catalog.cache.ttl=300
          catalog.batch.size=100
          logging.level=INFO
        grpc.conf: |
          max_receive_message_length: 4194304
          max_send_message_length: 4194304
          keepalive_time_ms: 30000
          keepalive_timeout_ms: 5000
    traits:
      position:
        x: 100
        y: 100

  - id: ms-catalogs-grpc-secret
    name: MS Catalogs gRPC Secret
    type: Secret
    namespace: catalogs
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc-secret
      type: Opaque
      data:
        database-url: cG9zdGdyZXNxbDovL3VzZXI6cGFzc3dvcmRAcG9zdGdyZXM6NTQzMi9jYXRhbG9nZGI=
        api-key: YWJjZGVmZ2hpams=
        jwt-secret: bXlfc2VjcmV0X2tleV8xMjM0NTY3ODkw
    traits:
      position:
        x: 100
        y: 300

  - id: ms-catalogs-grpc-hpa
    name: MS Catalogs gRPC HPA
    type: HorizontalPodAutoscaler
    namespace: catalogs
    version: autoscaling/v2
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc-hpa
      spec:
        scaleTargetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: ms-catalogs-grpc
        minReplicas: 2
        maxReplicas: 10
        metrics:
        - type: Resource
          resource:
            name: cpu
            target:
              type: Utilization
              averageUtilization: 70
        - type: Resource
          resource:
            name: memory
            target:
              type: Utilization
              averageUtilization: 80
    traits:
      position:
        x: 500
        y: 400

  - id: ms-catalogs-grpc-serviceaccount
    name: MS Catalogs gRPC Service Account
    type: ServiceAccount
    namespace: catalogs
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc
        labels:
          app: ms-catalogs-grpc
    traits:
      position:
        x: 100
        y: 200

  - id: ms-catalogs-grpc-namespace
    name: Catalogs Namespace
    type: Namespace
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: catalogs
        labels:
          name: catalogs
          istio-injection: enabled
    traits:
      position:
        x: 50
        y: 50

  - id: ms-catalogs-grpc-pdb
    name: MS Catalogs gRPC Pod Disruption Budget
    type: PodDisruptionBudget
    namespace: catalogs
    version: policy/v1
    model: kubernetes
    configuration:
      metadata:
        name: ms-catalogs-grpc-pdb
      spec:
        minAvailable: 2
        selector:
          matchLabels:
            app: ms-catalogs-grpc
    traits:
      position:
        x: 300
        y: 400

relationships:
  - id: deployment-service-relationship
    type: network
    subType: service
    source: ms-catalogs-grpc-deployment
    target: ms-catalogs-grpc-service
  
  - id: deployment-configmap-relationship
    type: mount
    subType: volume
    source: ms-catalogs-grpc-deployment
    target: ms-catalogs-grpc-configmap
    
  - id: deployment-secret-relationship
    type: mount
    subType: volume
    source: ms-catalogs-grpc-deployment
    target: ms-catalogs-grpc-secret
    
  - id: deployment-serviceaccount-relationship
    type: binding
    subType: permission
    source: ms-catalogs-grpc-deployment
    target: ms-catalogs-grpc-serviceaccount
    
  - id: hpa-deployment-relationship
    type: binding
    subType: scaling
    source: ms-catalogs-grpc-hpa
    target: ms-catalogs-grpc-deployment
    
  - id: pdb-deployment-relationship
    type: policy
    subType: availability
    source: ms-catalogs-grpc-pdb
    target: ms-catalogs-grpc-deployment
    
  - id: namespace-deployment-relationship
    type: parent
    subType: inventory
    source: ms-catalogs-grpc-namespace
    target: ms-catalogs-grpc-deployment
    
  - id: namespace-service-relationship
    type: parent
    subType: inventory
    source: ms-catalogs-grpc-namespace
    target: ms-catalogs-grpc-service
    
  - id: namespace-configmap-relationship
    type: parent
    subType: inventory
    source: ms-catalogs-grpc-namespace
    target: ms-catalogs-grpc-configmap
    
  - id: namespace-secret-relationship
    type: parent
    subType: inventory
    source: ms-catalogs-grpc-namespace
    target: ms-catalogs-grpc-secret
