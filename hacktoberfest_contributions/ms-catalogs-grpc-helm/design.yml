name: MS Catalogs gRPC Microservice
version: 0.0.1
services:
  ms-catalogs-grpc-deployment:
    name: ms-catalogs-grpc
    type: Deployment
    apiVersion: apps/v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        replicas: 3
        selector:
          matchLabels:
            app: ms-catalogs-grpc
            version: v1
        template:
          metadata:
            labels:
              app: ms-catalogs-grpc
              version: v1
          spec:
            serviceAccountName: ms-catalogs-grpc
            containers:
            - name: ms-catalogs-grpc
              image: ms-catalogs-grpc:1.0.0
              ports:
              - containerPort: 8080
                name: grpc
                protocol: TCP
              - containerPort: 8081
                name: health
                protocol: TCP
              env:
              - name: DATABASE_URL
                valueFrom:
                  secretKeyRef:
                    name: ms-catalogs-grpc-secret
                    key: database-url
              resources:
                limits:
                  cpu: 500m
                  memory: 512Mi
                requests:
                  cpu: 200m
                  memory: 256Mi
              livenessProbe:
                httpGet:
                  path: /health
                  port: 8081
                initialDelaySeconds: 30
                periodSeconds: 10
              readinessProbe:
                httpGet:
                  path: /ready
                  port: 8081
                initialDelaySeconds: 5
                periodSeconds: 5
              volumeMounts:
              - name: config-volume
                mountPath: /config
              - name: secret-volume
                mountPath: /secrets
                readOnly: true
            volumes:
            - name: config-volume
              configMap:
                name: ms-catalogs-grpc-config
            - name: secret-volume
              secret:
                secretName: ms-catalogs-grpc-secret
    traits:
      meshmap:
        edges: []
        id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/grpc/icon/color/grpc-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 100

  ms-catalogs-grpc-service:
    name: ms-catalogs-grpc
    type: Service
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        type: ClusterIP
        selector:
          app: ms-catalogs-grpc
          version: v1
        ports:
        - name: grpc
          port: 8080
          targetPort: 8080
          protocol: TCP
        - name: health
          port: 8081
          targetPort: 8081
          protocol: TCP
    traits:
      meshmap:
        edges: []
        id: b2c3d4e5-f6a7-8901-bcde-f12345678901
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 100

  ms-catalogs-grpc-config:
    name: ms-catalogs-grpc-config
    type: ConfigMap
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      data:
        application.properties: |
          grpc.port=8080
          health.port=8081
          service.name=ms-catalogs-grpc
        grpc.config: |
          maxConnectionIdle: 300s
          maxConnectionAge: 600s
          keepaliveTime: 120s
          keepaliveTimeout: 20s
    traits:
      meshmap:
        edges: []
        id: c3d4e5f6-a7b8-9012-cdef-123456789012
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 300

  ms-catalogs-grpc-secret:
    name: ms-catalogs-grpc-secret
    type: Secret
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      type: Opaque
      data:
        database-url: PEJBU0U2NC1FTkNPREVELURCLVVSTD4=
        api-key: PEJBU0U2NC1FTkNPREVELUFQSS1LRVk+
        jwt-secret: PEJBU0U2NC1FTkNPREVELUpXVC1TRUNSRVQ+
    traits:
      meshmap:
        edges: []
        id: d4e5f6a7-b8c9-0123-def0-123456789abc
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 300

  ms-catalogs-grpc-hpa:
    name: ms-catalogs-grpc
    type: HorizontalPodAutoscaler
    apiVersion: autoscaling/v2
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        scaleTargetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: ms-catalogs-grpc
        minReplicas: 3
        maxReplicas: 10
        metrics:
        - type: Resource
          resource:
            name: cpu
            target:
              type: Utilization
              averageUtilization: 70
        - type: Resource
          resource:
            name: memory
            target:
              type: Utilization
              averageUtilization: 80
    traits:
      meshmap:
        edges: []
        id: e5f6a7b8-c9d0-1234-ef01-23456789abcd
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 500
          posY: 100

  ms-catalogs-grpc-sa:
    name: ms-catalogs-grpc
    type: ServiceAccount
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings: {}
    traits:
      meshmap:
        edges: []
        id: f6a7b8c9-d0e1-2345-f012-3456789abcde
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 500
          posY: 300

  catalogs-namespace:
    name: catalogs
    type: Namespace
    apiVersion: v1
    model: kubernetes
    settings:
      metadata:
        labels:
          istio-injection: enabled
          name: catalogs
    traits:
      meshmap:
        edges: []
        id: a7b8c9d0-e1f2-3456-0123-456789abcdef
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: false
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 500

  ms-catalogs-grpc-pdb:
    name: ms-catalogs-grpc
    type: PodDisruptionBudget
    apiVersion: policy/v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        minAvailable: 2
        selector:
          matchLabels:
            app: ms-catalogs-grpc
            version: v1
    traits:
      meshmap:
        edges: []
        id: b8c9d0e1-f2a3-4567-1234-56789abcdef0
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 500

relationships:
  - name: service-to-deployment
    type: network
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Service
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: config-mount
    type: mount
    subType: ""
    selectors:
    - allow:
        from:
        - kind: ConfigMap
          match:
            refs:
            - name: ms-catalogs-grpc-config
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: secret-mount
    type: mount
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Secret
          match:
            refs:
            - name: ms-catalogs-grpc-secret
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: hpa-scales-deployment
    type: scaling
    subType: ""
    selectors:
    - allow:
        from:
        - kind: HorizontalPodAutoscaler
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: sa-binding
    type: permission
    subType: ""
    selectors:
    - allow:
        from:
        - kind: ServiceAccount
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: pdb-protects-deployment
    type: policy
    subType: ""
    selectors:
    - allow:
        from:
        - kind: PodDisruptionBudget
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: namespace-parent
    type: parent
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Namespace
          match:
            refs:
            - name: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: Service
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: ConfigMap
          match:
            refs:
            - name: ms-catalogs-grpc-config
              namespace: catalogs
        - kind: Secret
          match:
            refs:
            - name: ms-catalogs-grpc-secret
              namespace: catalogs
        - kind: HorizontalPodAutoscaler
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: ServiceAccount
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: PodDisruptionBudget
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
EOFDESIGN# Edit the design file directly
cat > hacktoberfest_contributions/ms-catalogs-grpc-helm/design.yml << 'EOFDESIGN'
name: MS Catalogs gRPC Microservice
version: 0.0.1
services:
  ms-catalogs-grpc-deployment:
    name: ms-catalogs-grpc
    type: Deployment
    apiVersion: apps/v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        replicas: 3
        selector:
          matchLabels:
            app: ms-catalogs-grpc
            version: v1
        template:
          metadata:
            labels:
              app: ms-catalogs-grpc
              version: v1
          spec:
            serviceAccountName: ms-catalogs-grpc
            containers:
            - name: ms-catalogs-grpc
              image: ms-catalogs-grpc:1.0.0
              ports:
              - containerPort: 8080
                name: grpc
                protocol: TCP
              - containerPort: 8081
                name: health
                protocol: TCP
              env:
              - name: DATABASE_URL
                valueFrom:
                  secretKeyRef:
                    name: ms-catalogs-grpc-secret
                    key: database-url
              resources:
                limits:
                  cpu: 500m
                  memory: 512Mi
                requests:
                  cpu: 200m
                  memory: 256Mi
              livenessProbe:
                httpGet:
                  path: /health
                  port: 8081
                initialDelaySeconds: 30
                periodSeconds: 10
              readinessProbe:
                httpGet:
                  path: /ready
                  port: 8081
                initialDelaySeconds: 5
                periodSeconds: 5
              volumeMounts:
              - name: config-volume
                mountPath: /config
              - name: secret-volume
                mountPath: /secrets
                readOnly: true
            volumes:
            - name: config-volume
              configMap:
                name: ms-catalogs-grpc-config
            - name: secret-volume
              secret:
                secretName: ms-catalogs-grpc-secret
    traits:
      meshmap:
        edges: []
        id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/grpc/icon/color/grpc-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 100

  ms-catalogs-grpc-service:
    name: ms-catalogs-grpc
    type: Service
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        type: ClusterIP
        selector:
          app: ms-catalogs-grpc
          version: v1
        ports:
        - name: grpc
          port: 8080
          targetPort: 8080
          protocol: TCP
        - name: health
          port: 8081
          targetPort: 8081
          protocol: TCP
    traits:
      meshmap:
        edges: []
        id: b2c3d4e5-f6a7-8901-bcde-f12345678901
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 100

  ms-catalogs-grpc-config:
    name: ms-catalogs-grpc-config
    type: ConfigMap
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      data:
        application.properties: |
          grpc.port=8080
          health.port=8081
          service.name=ms-catalogs-grpc
        grpc.config: |
          maxConnectionIdle: 300s
          maxConnectionAge: 600s
          keepaliveTime: 120s
          keepaliveTimeout: 20s
    traits:
      meshmap:
        edges: []
        id: c3d4e5f6-a7b8-9012-cdef-123456789012
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 300

  ms-catalogs-grpc-secret:
    name: ms-catalogs-grpc-secret
    type: Secret
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings:
      type: Opaque
      data:
        database-url: PEJBU0U2NC1FTkNPREVELURCLVVSTD4=
        api-key: PEJBU0U2NC1FTkNPREVELUFQSS1LRVk+
        jwt-secret: PEJBU0U2NC1FTkNPREVELUpXVC1TRUNSRVQ+
    traits:
      meshmap:
        edges: []
        id: d4e5f6a7-b8c9-0123-def0-123456789abc
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 300

  ms-catalogs-grpc-hpa:
    name: ms-catalogs-grpc
    type: HorizontalPodAutoscaler
    apiVersion: autoscaling/v2
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        scaleTargetRef:
          apiVersion: apps/v1
          kind: Deployment
          name: ms-catalogs-grpc
        minReplicas: 3
        maxReplicas: 10
        metrics:
        - type: Resource
          resource:
            name: cpu
            target:
              type: Utilization
              averageUtilization: 70
        - type: Resource
          resource:
            name: memory
            target:
              type: Utilization
              averageUtilization: 80
    traits:
      meshmap:
        edges: []
        id: e5f6a7b8-c9d0-1234-ef01-23456789abcd
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 500
          posY: 100

  ms-catalogs-grpc-sa:
    name: ms-catalogs-grpc
    type: ServiceAccount
    apiVersion: v1
    namespace: catalogs
    model: kubernetes
    settings: {}
    traits:
      meshmap:
        edges: []
        id: f6a7b8c9-d0e1-2345-f012-3456789abcde
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 500
          posY: 300

  catalogs-namespace:
    name: catalogs
    type: Namespace
    apiVersion: v1
    model: kubernetes
    settings:
      metadata:
        labels:
          istio-injection: enabled
          name: catalogs
    traits:
      meshmap:
        edges: []
        id: a7b8c9d0-e1f2-3456-0123-456789abcdef
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: false
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 300
          posY: 500

  ms-catalogs-grpc-pdb:
    name: ms-catalogs-grpc
    type: PodDisruptionBudget
    apiVersion: policy/v1
    namespace: catalogs
    model: kubernetes
    settings:
      spec:
        minAvailable: 2
        selector:
          matchLabels:
            app: ms-catalogs-grpc
            version: v1
    traits:
      meshmap:
        edges: []
        id: b8c9d0e1-f2a3-4567-1234-56789abcdef0
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kubernetes/icon/color/kubernetes-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 100
          posY: 500

relationships:
  - name: service-to-deployment
    type: network
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Service
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: config-mount
    type: mount
    subType: ""
    selectors:
    - allow:
        from:
        - kind: ConfigMap
          match:
            refs:
            - name: ms-catalogs-grpc-config
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: secret-mount
    type: mount
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Secret
          match:
            refs:
            - name: ms-catalogs-grpc-secret
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: hpa-scales-deployment
    type: scaling
    subType: ""
    selectors:
    - allow:
        from:
        - kind: HorizontalPodAutoscaler
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: sa-binding
    type: permission
    subType: ""
    selectors:
    - allow:
        from:
        - kind: ServiceAccount
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: pdb-protects-deployment
    type: policy
    subType: ""
    selectors:
    - allow:
        from:
        - kind: PodDisruptionBudget
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs

  - name: namespace-parent
    type: parent
    subType: ""
    selectors:
    - allow:
        from:
        - kind: Namespace
          match:
            refs:
            - name: catalogs
        to:
        - kind: Deployment
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: Service
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: ConfigMap
          match:
            refs:
            - name: ms-catalogs-grpc-config
              namespace: catalogs
        - kind: Secret
          match:
            refs:
            - name: ms-catalogs-grpc-secret
              namespace: catalogs
        - kind: HorizontalPodAutoscaler
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: ServiceAccount
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
        - kind: PodDisruptionBudget
          match:
            refs:
            - name: ms-catalogs-grpc
              namespace: catalogs
